<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <title>Offene Geisternetze</title>
    <link rel="stylesheet" th:href="@{/css/app.css}" />
</head>

<body>
    <header>
        <h2>GhostNet Global</h2>
        <nav>
            <a th:href="@{/nets}">Netze</a> |
            <a th:href="@{/nets/new}">Melden</a> |
            <a th:href="@{/nets/map}">Karte</a>
        </nav>
    </header>
    <h1>Gemeldete Geisternetze</h1>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Koordinaten</th>
                <th>Größe</th>
                <th>Status</th>
                <th>Bergende Person</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="n : ${nets}">
                <td th:text="${n.id}">1</td>
                <td th:text="${n.latitude + ', ' + n.longitude}">0,0</td>
                <td th:text="${n.sizeEstimate}">Mittel</td>

                <!-- Badge: generiert Klasse aus Status (GEMELDET -> .gemeldet, BERGUNG_BEVORSTEHEND -> .bergung-bevorstehend, etc.) -->
                <td>
                    <span class="badge" th:text="${n.status}"
                        th:classappend="${' ' + #strings.toLowerCase(n.status.name()).replace('_','-')}">
                        GEMELDET
                    </span>
                </td>

                <!-- Rescuer-Name oder — -->
                <td th:text="${n.assignedRescuer != null ? n.assignedRescuer.name : '—'}">—</td>

                <td class="inline">
                    <!-- Zuordnen / ändern nur wenn nicht geborgen -->
                    <a class="btn secondary" th:if="${n.status.name() != 'GEBORGEN'}"
                        th:href="@{'/nets/' + ${n.id} + '/assign'}">
                        Zuordnen
                    </a>

                    <!-- Als geborgen melden -->
                    <form th:if="${n.status.name() != 'GEBORGEN'}" th:action="@{'/nets/' + ${n.id} + '/salvage'}"
                        method="post" style="display:inline">
                        <button type="submit" class="btn">Als geborgen melden</button>
                    </form>

                    <!-- Als verschollen melden (erfordert Reporter mit Telefonnummer) -->
                    <form th:if="${n.status.name() != 'GEBORGEN'}" th:action="@{'/nets/' + ${n.id} + '/missing'}"
                        method="post" class="inline" style="gap:8px">
                        <select name="reporterId" required>
                            <option value="" disabled selected>Reporter wählen</option>
                            <option th:each="p : ${reporters}" th:value="${p.id}"
                                th:text="${p.name + (p.phone != null ? ' (' + p.phone + ')' : '')}">
                                Person
                            </option>
                        </select>
                        <button type="submit" class="btn danger">Als verschollen melden</button>
                    </form>

                </td>

            </tr>
        </tbody>
    </table>

    <div th:if="${#lists.isEmpty(salvaged)}" class="alert">Noch keine geborgenen Netze.</div>

    <h1>Geborgene Geisternetze</h1>

    <table th:if="${!#lists.isEmpty(salvaged)}">
        <thead>
            <tr>
                <th>ID</th>
                <th>Koordinaten</th>
                <th>Größe</th>
                <th>Status</th>
                <th>Bergende Person</th>
                <th>Gemeldet am</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="n : ${salvaged}">
                <td th:text="${n.id}">1</td>
                <td th:text="${n.latitude + ', ' + n.longitude}">0,0</td>
                <td th:text="${n.sizeEstimate}">Mittel</td>
                <td>
                    <span class="badge geborgen">GEBORGEN</span>
                </td>
                <td th:text="${n.assignedRescuer != null ? n.assignedRescuer.name : '—'}">—</td>
                <td th:text="${#temporals.format(n.createdAt, 'yyyy-MM-dd HH:mm')}">2025-09-21 13:37</td>
            </tr>
        </tbody>
    </table>
    </div>


</body>

</html>